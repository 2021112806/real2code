# Real2Code 脚本运行建议

## 修改后的脚本说明

我已经将您的bash脚本中的路径修改为符合当前文件结构：

### 1. process_data.sh
- **数据目录**: `/mnt/data/zhangzhaodong/real2code/datasets/partnet-mobility-v0/dataset`
- **输出目录**: `/mnt/data/zhangzhaodong/real2code/output`
- **功能**: 渲染PartNet-Mobility数据并进行预处理

### 2. sam_finetune.sh
- **数据目录**: `/mnt/data/zhangzhaodong/real2code/output`
- **功能**: 使用渲染后的数据微调SAM模型

### 3. shape_completion_datagen.sh
- **数据目录**: `/mnt/data/zhangzhaodong/real2code/output`
- **输出目录**: `/mnt/data/zhangzhaodong/real2code/shape_output`
- **功能**: 生成形状补全训练数据

## 运行建议

### 步骤1: 环境准备
```bash
# 激活conda环境
conda activate real2code

# 确保在项目根目录
cd /mnt/data/zhangzhaodong/real2code
```

### 步骤2: 数据渲染和预处理
```bash
# 运行数据处理脚本
bash bash_scripts/process_data.sh
```

**预期输出**:
- 渲染数据保存在: `/mnt/data/zhangzhaodong/real2code/output/`
- 包含眼镜和剪刀对象的渲染结果

### 步骤3: SAM模型微调
```bash
# 运行SAM微调
bash bash_scripts/sam_finetune.sh
```

**注意**: 确保 `part_segmentation/finetune_sam.py` 文件存在

### 步骤4: 形状补全数据生成
```bash
# 运行形状补全数据生成
bash bash_scripts/shape_completion_datagen.sh
```

**预期输出**:
- 形状补全数据保存在: `/mnt/data/zhangzhaodong/real2code/shape_output/`

## 运行前检查

### 1. 检查数据目录
```bash
# 检查PartNet-Mobility数据
ls -la /mnt/data/zhangzhaodong/real2code/datasets/partnet-mobility-v0/dataset/ | head -10

# 检查真实世界数据
ls -la /mnt/data/zhangzhaodong/real2code/datasets/real_world_data/
```

### 2. 检查模型文件
```bash
# 检查SAM模型
ls -la /mnt/data/zhangzhaodong/real2code/models/sam/

# 检查CodeLlama模型
ls -la /mnt/data/zhangzhaodong/real2code/models/codellama/
```

### 3. 检查依赖模块
```bash
# 检查part_segmentation模块
ls -la /mnt/data/zhangzhaodong/real2code/part_segmentation/

# 检查shape_complete模块
ls -la /mnt/data/zhangzhaodong/real2code/shape_complete/
```

## 运行顺序建议

### 完整流程
```bash
# 1. 数据处理
bash bash_scripts/process_data.sh

# 2. SAM微调
bash bash_scripts/sam_finetune.sh

# 3. 形状补全数据生成
bash bash_scripts/shape_completion_datagen.sh
```

### 单独运行
```bash
# 只运行数据处理
bash bash_scripts/process_data.sh

# 只运行SAM微调（需要先完成数据处理）
bash bash_scripts/sam_finetune.sh

# 只运行形状补全（需要先完成数据处理）
bash bash_scripts/shape_completion_datagen.sh
```

## 常见问题解决

### 1. 路径问题
如果遇到路径错误，检查：
- 当前工作目录是否为 `/mnt/data/zhangzhaodong/real2code`
- 数据目录是否存在
- 输出目录是否有写权限

### 2. 权限问题
```bash
# 创建输出目录并设置权限
mkdir -p /mnt/data/zhangzhaodong/real2code/output
mkdir -p /mnt/data/zhangzhaodong/real2code/shape_output
chmod 755 /mnt/data/zhangzhaodong/real2code/output
chmod 755 /mnt/data/zhangzhaodong/real2code/shape_output
```

### 3. GPU内存问题
如果GPU内存不足，可以修改脚本中的参数：
- 减少 `--batch_size`
- 减少 `--num_loops` 和 `--num_frames`

### 4. 依赖模块缺失
如果 `part_segmentation` 或 `shape_complete` 模块不存在，需要：
- 检查这些目录是否存在
- 如果不存在，可能需要从其他来源获取这些模块

## 监控运行状态

### 1. 检查渲染进度
```bash
# 查看渲染输出
ls -la /mnt/data/zhangzhaodong/real2code/output/test/Eyeglasses/
```

### 2. 检查预处理进度
```bash
# 查看预处理输出
ls -la /mnt/data/zhangzhaodong/real2code/output/test/Eyeglasses/101844/
```

### 3. 检查训练进度
```bash
# 查看SAM微调日志
tail -f sam_training.log

# 查看形状补全数据生成进度
ls -la /mnt/data/zhangzhaodong/real2code/shape_output/
```

## 性能优化建议

### 1. 使用多GPU
```bash
# 修改脚本中的CUDA_VISIBLE_DEVICES
export CUDA_VISIBLE_DEVICES=0,1,2,3
```

### 2. 调整批处理大小
根据GPU内存调整 `--batch_size` 参数

### 3. 减少渲染参数
对于快速测试，可以减少 `--num_loops` 和 `--num_frames`

## 输出文件结构

运行完成后，您将得到以下输出结构：

```
/mnt/data/zhangzhaodong/real2code/
├── output/                    # 渲染和预处理输出
│   ├── test/
│   │   ├── Eyeglasses/
│   │   └── Scissors/
│   └── shard_output/         # 训练数据shard文件
├── shape_output/             # 形状补全数据
│   └── vis/                  # 可视化结果
└── models/                   # 微调后的模型
    ├── sam/
    └── codellama/
```

这些脚本现在应该能够与您的文件结构完美配合运行！
